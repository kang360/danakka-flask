<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ‘¤ ë§ˆì´í˜ì´ì§€</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>
    .profile-card {
      background-color: #ffffff;
      border: 1px solid #e3e3e3;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .alert {
      margin-bottom: 15px;
    }
    .list-group-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f9f9f9;
      border: 1px solid #ddd;
    }
    .list-group-item strong {
      font-weight: 600;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="mb-4 text-primary">ğŸ‘¤ ë§ˆì´í˜ì´ì§€</h2>
    <div class="profile-card mb-4 p-4">
      <h4>ğŸ“§ íšŒì› ì •ë³´ ìˆ˜ì •</h4>
      <form method="POST">
        <div class="mb-3">
          <label for="email" class="form-label">ì´ë©”ì¼ (ë³€ê²½ ë¶ˆê°€)</label>
          <input type="email" class="form-control" value="{{ user.email }}" readonly>
        </div>
        <div class="mb-3">
          <label for="nickname" class="form-label">ë‹‰ë„¤ì„</label>
          <input type="text" name="nickname" class="form-control" value="{{ user.nickname }}" required>
        </div>
        <div class="mb-3">
          <label for="current_password" class="form-label">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" name="current_password" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="new_password" class="form-label">ì‹ ê·œ ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½í•  ê²½ìš°ë§Œ)</label>
          <input type="password" name="new_password" class="form-control">
        </div>
        <div class="d-flex justify-content-between align-items-center">
          <button type="submit" class="btn btn-primary">ğŸ‘¤ ì •ë³´ ìˆ˜ì •</button>
          <a href="/" class="btn btn-secondary">ğŸ  í™ˆìœ¼ë¡œ</a>
        </div>
      </form>
    </div>

    <div class="profile-card mb-4 p-4">
      <h4 class="mb-3 text-danger">ğŸš« íšŒì› íƒˆí‡´</h4>
      <form action="/delete_account" method="POST">
        <button type="submit" class="btn btn-danger w-100" onclick="return confirm('ì •ë§ë¡œ íšŒì› íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ğŸš« íšŒì› íƒˆí‡´</button>
      </form>
    </div>

   <div class="container mt-4">
  <h2 class="mb-3">ğŸ”” ì˜ˆì•½ ì•Œë¦¼ ëª©ë¡</h2>
  <div class="card">
    <div class="card-body">
      {% if alarms %}
        <table class="table table-striped">
  <thead>
    <tr>
      <th>ë‚ ì§œ</th>
      <th>ì§€ì—­</th>
      <th>ì„ ë°•</th>
      <th>ì‚­ì œ</th>
    </tr>
  </thead>
  <tbody id="alarm-list">
    {% for alarm in alarms %}
      <tr id="alarm-{{ alarm.id }}">
        <td>{{ alarm.date }}</td>
        <td>{{ alarm.zone }}</td>
        <td>{{ alarm.ship_name }}</td>
        <td>
          <button class="btn btn-danger btn-sm" onclick="deleteAlarm({{ alarm.id }})">âŒ ì‚­ì œ</button>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
      {% else %}
        <p class="text-muted text-center">ë“±ë¡ëœ ì˜ˆì•½ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      {% endif %}
    </div>
  </div>
</div>
<script>
  // âœ… ì˜ˆì•½ ì•Œë¦¼ ì‚­ì œ (AJAX)
  function deleteAlarm(alarmId) {
    if (!confirm("ì •ë§ë¡œ ì´ ì•Œë¦¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

    fetch(`/delete_alarm/${alarmId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (!response.ok) {
        return response.text().then(text => { throw new Error(text) });
      }
      return response.json();
    })
    .then(data => {
      if (data.success) {
        alert(data.message);
        // âœ… ì‚­ì œëœ ì•Œë¦¼ í–‰ì„ ì§ì ‘ DOMì—ì„œ ì œê±°
        const row = document.getElementById(`alarm-${alarmId}`);
        if (row) {
          row.remove();
        }

        // âœ… ë§Œì•½ ì•Œë¦¼ì´ ëª¨ë‘ ì‚­ì œë˜ë©´ ë¹ˆ ë©”ì‹œì§€ í‘œì‹œ
        if (document.querySelectorAll("#alarm-list tr").length === 0) {
          document.getElementById("alarm-list").innerHTML = `
            <tr>
              <td colspan="4" class="text-muted text-center">ë“±ë¡ëœ ì˜ˆì•½ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</td>
            </tr>
          `;
        }
      } else {
        alert(data.message || "ì•Œë¦¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    })
    .catch(error => {
      console.error("âŒ ìš”ì²­ ì˜¤ë¥˜:", error);
      alert("ì•Œë¦¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    });
  }
</script>


</body>
</html>
